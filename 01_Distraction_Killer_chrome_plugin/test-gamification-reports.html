<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamification Reports Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            padding: 10px 15px; 
            margin: 5px; 
            cursor: pointer; 
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
        #output { 
            border: 1px solid #ccc; 
            padding: 15px; 
            margin-top: 20px; 
            min-height: 200px; 
            background: #f9f9f9; 
            white-space: pre-wrap; 
            font-family: monospace; 
            border-radius: 4px;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .test-section {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Gamification Reports Test</h1>
        <p>This page tests the gamification section in the reports page.</p>
        
        <div class="test-section">
            <h3>üß™ Test Gamification Data</h3>
            <button onclick="testGamificationData()">Test Gamification Data</button>
            <button onclick="testReportsPage()">Open Reports Page</button>
            <button onclick="simulateGamificationData()">Simulate Test Data</button>
        </div>

        <div class="test-section">
            <h3>üîß Test Specific Functions</h3>
            <button onclick="testGamificationSummary()">Test Summary</button>
            <button onclick="testSessionData()">Test Session Data</button>
            <button onclick="testBadges()">Test Badges</button>
        </div>

        <div>
            <button onclick="clearOutput()">üóëÔ∏è Clear Output</button>
        </div>

        <div id="output">Gamification Reports Test Page Loaded. Click buttons above to test gamification functionality.</div>
    </div>

    <script>
        const outputDiv = document.getElementById('output');
        
        const log = (message, type = 'info') => {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            outputDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            outputDiv.scrollTop = outputDiv.scrollHeight;
            console.log(message);
        };

        async function testGamificationData() {
            log('--- Testing Gamification Data ---');
            
            try {
                // Check if gamification is available
                if (window.gamification) {
                    log('Gamification object found', 'success');
                    
                    // Test getGamificationSummary
                    const summary = window.gamification.getGamificationSummary();
                    log(`Summary: ${JSON.stringify(summary, null, 2)}`, 'success');
                    
                    // Test getCurrentLevel
                    const currentLevel = window.gamification.getCurrentLevel();
                    log(`Current Level: ${JSON.stringify(currentLevel, null, 2)}`, 'success');
                    
                    // Test getGamificationReportData
                    const reportData = window.gamification.getGamificationReportData();
                    log(`Report Data: ${JSON.stringify(reportData, null, 2)}`, 'success');
                    
                } else {
                    log('Gamification object not found', 'error');
                }
            } catch (e) {
                log(`Error testing gamification data: ${e.message}`, 'error');
            }
        }

        async function testReportsPage() {
            log('--- Opening Reports Page ---');
            
            try {
                // Open reports page in new tab
                const reportsUrl = chrome.runtime.getURL('reports.html');
                chrome.tabs.create({ url: reportsUrl });
                log('Reports page opened in new tab', 'success');
            } catch (e) {
                log(`Error opening reports page: ${e.message}`, 'error');
            }
        }

        async function simulateGamificationData() {
            log('--- Simulating Test Gamification Data ---');
            
            try {
                // Create test gamification data
                const testData = {
                    totalPoints: 150,
                    dailyStreak: 3,
                    weeklyStreak: 1,
                    lastSessionDate: new Date().toISOString().split('T')[0],
                    lastWeekStart: new Date().toISOString().split('T')[0],
                    earnedBadges: ['first_session', 'week_streak'],
                    sessionHistory: [
                        {
                            type: 'session_complete',
                            sessionId: 'test-session-1',
                            timestamp: Date.now() - 86400000, // 1 day ago
                            data: { durationMinutes: 30, hadBlockedAttempts: false, hadOverrides: false, wasPaused: false }
                        },
                        {
                            type: 'blocked_attempt',
                            sessionId: 'test-session-1',
                            timestamp: Date.now() - 86400000 + 60000,
                            data: { url: 'https://facebook.com', category: 'social' }
                        },
                        {
                            type: 'session_complete',
                            sessionId: 'test-session-2',
                            timestamp: Date.now() - 172800000, // 2 days ago
                            data: { durationMinutes: 45, hadBlockedAttempts: true, hadOverrides: false, wasPaused: false }
                        }
                    ],
                    dailyPoints: {
                        [new Date().toISOString().split('T')[0]]: 20,
                        [new Date(Date.now() - 86400000).toISOString().split('T')[0]]: 15
                    },
                    weeklyPoints: {
                        [new Date().toISOString().split('T')[0]]: 35
                    }
                };
                
                // Store test data
                await chrome.storage.local.set({ gamificationData: testData });
                log('Test gamification data stored', 'success');
                
                // Reload gamification if available
                if (window.gamification) {
                    await window.gamification.loadGamificationData();
                    log('Gamification data reloaded', 'success');
                }
                
            } catch (e) {
                log(`Error simulating gamification data: ${e.message}`, 'error');
            }
        }

        async function testGamificationSummary() {
            log('--- Testing Gamification Summary ---');
            
            try {
                if (window.gamification) {
                    const summary = window.gamification.getGamificationSummary();
                    
                    log(`Total Points: ${summary.totalPoints}`);
                    log(`Current Level: ${summary.currentLevel}`);
                    log(`Daily Streak: ${summary.dailyStreak}`);
                    log(`Weekly Streak: ${summary.weeklyStreak}`);
                    log(`Points Today: ${summary.pointsToday}`);
                    log(`Points to Next Level: ${summary.pointsToNextLevel}`);
                    log(`Earned Badges: ${summary.earnedBadges.length}`);
                    
                    if (summary.earnedBadges.length > 0) {
                        summary.earnedBadges.forEach(badge => {
                            log(`  - ${badge.name}: ${badge.description}`);
                        });
                    }
                } else {
                    log('Gamification not available', 'error');
                }
            } catch (e) {
                log(`Error testing summary: ${e.message}`, 'error');
            }
        }

        async function testSessionData() {
            log('--- Testing Session Data ---');
            
            try {
                if (window.gamification) {
                    const reportData = window.gamification.getGamificationReportData();
                    
                    log(`Recent Sessions: ${reportData.recentSessions.length}`);
                    
                    reportData.recentSessions.forEach((session, index) => {
                        log(`Session ${index + 1}:`);
                        log(`  - Points: ${session.sessionPoints}`);
                        log(`  - Attempts: ${session.attempts}`);
                        log(`  - Overrides: ${session.overrides}`);
                        log(`  - Was Paused: ${session.wasPaused}`);
                        log(`  - Stopped Early: ${session.stoppedEarly}`);
                    });
                } else {
                    log('Gamification not available', 'error');
                }
            } catch (e) {
                log(`Error testing session data: ${e.message}`, 'error');
            }
        }

        async function testBadges() {
            log('--- Testing Badges ---');
            
            try {
                if (window.gamification) {
                    const summary = window.gamification.getGamificationSummary();
                    
                    log(`Total Badges Available: ${window.gamification.badges.length}`);
                    log(`Earned Badges: ${summary.earnedBadges.length}`);
                    
                    window.gamification.badges.forEach(badge => {
                        const isEarned = summary.earnedBadges.some(earned => earned.id === badge.id);
                        log(`${isEarned ? '‚úÖ' : '‚ùå'} ${badge.name}: ${badge.description} (${badge.threshold})`);
                    });
                } else {
                    log('Gamification not available', 'error');
                }
            } catch (e) {
                log(`Error testing badges: ${e.message}`, 'error');
            }
        }

        function clearOutput() {
            outputDiv.textContent = '';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('Gamification Reports Test Page Loaded');
            log('This test will verify:');
            log('1. Gamification data loading works correctly');
            log('2. Reports page displays gamification section properly');
            log('3. All gamification functions work without errors');
            log('4. Dark theme support works correctly');
        });
    </script>
</body>
</html>
